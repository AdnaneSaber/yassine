
> yassine@0.1.0 test
> vitest


[1m[44m DEV [49m[22m [34mv3.2.4 [39m[90mC:/Users/AdnaneSABER/OneDrive - CHAPSVISION/Documents/GitHub/yassine-1[39m

 [32m‚úì[39m __tests__/unit/lib/workflow/constants.test.ts [2m([22m[2m28 tests[22m[2m)[22m[32m 7[2mms[22m[39m
 [32m‚úì[39m __tests__/unit/lib/utils.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 11[2mms[22m[39m
[90mstderr[2m | __tests__/unit/lib/workflow/state-machine.test.ts[2m > [22m[2mDemandeWorkflow[2m > [22m[2mnotifications[2m > [22m[2mne lance pas d'erreur si l'envoi d'email √©choue
[22m[39mFailed to send email notification: Erreur email

[90mstderr[2m | __tests__/unit/lib/workflow/state-machine.test.ts[2m > [22m[2mDemandeWorkflow[2m > [22m[2mnotifications[2m > [22m[2mne lance pas d'erreur si le service email lance une exception
[22m[39mError sending notification: Error: Erreur r√©seau
    at [90mC:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39m__tests__\unit\lib\workflow\state-machine.test.ts:278:82
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///C:/Users/AdnaneSABER/OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

 [32m‚úì[39m __tests__/unit/lib/workflow/state-machine.test.ts [2m([22m[2m31 tests[22m[2m)[22m[32m 26[2mms[22m[39m
 [32m‚úì[39m __tests__/unit/lib/validators/demande.test.ts [2m([22m[2m85 tests[22m[2m)[22m[32m 23[2mms[22m[39m
 [32m‚úì[39m __tests__/unit/components/demandes/demande-card.test.tsx [2m([22m[2m13 tests[22m[2m)[22m[32m 116[2mms[22m[39m
 [32m‚úì[39m __tests__/unit/components/demandes/demande-detail.test.tsx [2m([22m[2m21 tests[22m[2m)[22m[32m 198[2mms[22m[39m
[90mstderr[2m | __tests__/unit/components/admin/demandes-table.test.tsx[2m > [22m[2mDemandesTable[2m > [22m[2mg√®re les demandes sans _id
[22m[39mEach child in a list should have a unique "key" prop.

Check the render method of `TableBody`. It was passed a child from DemandesTable. See https://react.dev/link/warning-keys for more information.

 [32m‚úì[39m __tests__/unit/components/admin/demandes-table.test.tsx [2m([22m[2m17 tests[22m[2m)[22m[33m 301[2mms[22m[39m
(node:38440) [MONGOOSE] Warning: Duplicate schema index on {"matricule":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:38440) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:38440) [MONGOOSE] Warning: Duplicate schema index on {"numeroDemande":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:38440) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:33356) [MONGOOSE] Warning: Duplicate schema index on {"matricule":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:33356) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:33356) [MONGOOSE] Warning: Duplicate schema index on {"numeroDemande":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:33356) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:17200) [MONGOOSE] Warning: Duplicate schema index on {"matricule":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:17200) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:17200) [MONGOOSE] Warning: Duplicate schema index on {"numeroDemande":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:17200) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:34512) [MONGOOSE] Warning: Duplicate schema index on {"matricule":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:34512) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:34512) [MONGOOSE] Warning: Duplicate schema index on {"numeroDemande":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36552) [MONGOOSE] Warning: Duplicate schema index on {"matricule":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:36552) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:34516) [MONGOOSE] Warning: Duplicate schema index on {"matricule":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:34516) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:34512) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:34516) [MONGOOSE] Warning: Duplicate schema index on {"numeroDemande":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36552) [MONGOOSE] Warning: Duplicate schema index on {"numeroDemande":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36552) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:34516) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
[90mstderr[2m | __tests__/unit/components/admin/status-modifier-dialog.test.tsx[2m > [22m[2mStatusModifierDialog[2m > [22m[2msoumet le formulaire avec succ√®s
[22m[39mThe current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)

[90mstdout[2m | __tests__/integration/actions/demandes.test.ts[2m > [22m[2mServer Actions - Demandes[2m > [22m[2mcreateDemandeAction[2m > [22m[2mcr√©e une demande avec succ√®s pour un √©tudiant authentifi√©
[22m[39m‚úÖ MongoDB connected successfully

[90mstderr[2m | __tests__/integration/api/admin/students/route.test.ts[2m > [22m[2m/api/admin/students[2m > [22m[2mGET[2m > [22m[2mretourne une liste vide quand aucun √©tudiant n'existe
[22m[39mGet students error: MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections
    at NativeConnection.createClient [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\drivers\node-mongodb-native\connection.js:244:13[90m)[39m
    at NativeConnection.openUri [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\connection.js:1075:34[90m)[39m
    at Mongoose.connect [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\mongoose.js:451:15[90m)[39m
    at connectDB [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mlib\db\mongodb.ts:40:31[90m)[39m
    at Module.GET [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mapp\api\admin\students\route.ts:105:11[90m)[39m
    at [90mC:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39m__tests__\integration\api\admin\students\route.test.ts:59:25
    at [90mfile:///C:/Users/AdnaneSABER/OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///C:/Users/AdnaneSABER/OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///C:/Users/AdnaneSABER/OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)

[90mstderr[2m | __tests__/integration/api/demandes/route.test.ts[2m > [22m[2m/api/demandes[2m > [22m[2mGET[2m > [22m[2mretourne une liste vide quand aucune demande n'existe
[22m[39mAPI Error: MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections
    at NativeConnection.createClient [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\drivers\node-mongodb-native\connection.js:244:13[90m)[39m
    at NativeConnection.openUri [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\connection.js:1075:34[90m)[39m
    at Mongoose.connect [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\mongoose.js:451:15[90m)[39m
    at connectDB [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mlib\db\mongodb.ts:40:31[90m)[39m
    at Module.GET [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mapp\api\demandes\route.ts:14:11[90m)[39m
    at [90mC:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39m__tests__\integration\api\demandes\route.test.ts:34:25
    at [90mfile:///C:/Users/AdnaneSABER/OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///C:/Users/AdnaneSABER/OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///C:/Users/AdnaneSABER/OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)

[90mstderr[2m | __tests__/integration/api/demandes/[id]/route.test.ts[2m > [22m[2m/api/demandes/[id][2m > [22m[2mGET[2m > [22m[2mretourne les d√©tails d'une demande existante
[22m[39mAPI Error: MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections
    at NativeConnection.createClient [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\drivers\node-mongodb-native\connection.js:244:13[90m)[39m
    at NativeConnection.openUri [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\connection.js:1075:34[90m)[39m
    at Mongoose.connect [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\mongoose.js:451:15[90m)[39m
    at connectDB [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mlib\db\mongodb.ts:40:31[90m)[39m
    at GET [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mapp\api\demandes\[id]\route.ts:13:11[90m)[39m
    at [90mC:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39m__tests__\integration\api\demandes\[id]\route.test.ts:74:25
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///C:/Users/AdnaneSABER/OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

[90mstderr[2m | __tests__/integration/api/demandes/[id]/transition/route.test.ts[2m > [22m[2m/api/demandes/[id]/transition[2m > [22m[2mPOST[2m > [22m[2mtransitionne une demande de SOUMIS √† RECU
[22m[39mAPI Error: MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections
    at NativeConnection.createClient [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\drivers\node-mongodb-native\connection.js:244:13[90m)[39m
    at NativeConnection.openUri [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\connection.js:1075:34[90m)[39m
    at Mongoose.connect [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\mongoose.js:451:15[90m)[39m
    at connectDB [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mlib\db\mongodb.ts:40:31[90m)[39m
    at POST [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mapp\api\demandes\[id]\transition\route.ts:14:11[90m)[39m
    at [90mC:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39m__tests__\integration\api\demandes\[id]\transition\route.test.ts:88:25
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///C:/Users/AdnaneSABER/OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

 [32m‚úì[39m __tests__/integration/db/models/demande.test.ts [2m([22m[2m25 tests[22m[2m)[22m[33m 862[2mms[22m[39m
[90mstderr[2m | __tests__/unit/components/admin/status-modifier-dialog.test.tsx[2m > [22m[2mStatusModifierDialog[2m > [22m[2msoumet avec motif de refus pour le statut REJETE
[22m[39mThe current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)

[90mstderr[2m | __tests__/unit/components/admin/status-modifier-dialog.test.tsx[2m > [22m[2mStatusModifierDialog[2m > [22m[2mg√®re les erreurs de l'action
[22m[39mThe current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)

[90mstderr[2m | __tests__/unit/components/admin/status-modifier-dialog.test.tsx[2m > [22m[2mStatusModifierDialog[2m > [22m[2mg√®re les erreurs inattendues
[22m[39mThe current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)

[90mstdout[2m | __tests__/integration/api/demandes/[id]/route.test.ts[2m > [22m[2m/api/demandes/[id][2m > [22m[2mGET[2m > [22m[2mretourne une erreur 404 pour une demande inexistante
[22m[39m‚úÖ MongoDB connected successfully

[90mstdout[2m | __tests__/integration/api/admin/students/route.test.ts[2m > [22m[2m/api/admin/students[2m > [22m[2mGET[2m > [22m[2mretourne la liste des √©tudiants
[22m[39m‚úÖ MongoDB connected successfully

[90mstdout[2m | __tests__/integration/api/demandes/[id]/transition/route.test.ts[2m > [22m[2m/api/demandes/[id]/transition[2m > [22m[2mPOST[2m > [22m[2mretourne une erreur 404 pour une demande inexistante
[22m[39m‚úÖ MongoDB connected successfully

[90mstdout[2m | __tests__/integration/api/demandes/route.test.ts[2m > [22m[2m/api/demandes[2m > [22m[2mGET[2m > [22m[2mretourne la liste des demandes avec pagination
[22m[39m‚úÖ MongoDB connected successfully

[90mstderr[2m | __tests__/integration/api/demandes/route.test.ts[2m > [22m[2m/api/demandes[2m > [22m[2mGET[2m > [22m[2mretourne la liste des demandes avec pagination
[22m[39mAPI Error: ZodError: [
  {
    "origin": "number",
    "code": "too_small",
    "minimum": 0,
    "inclusive": false,
    "path": [
      "page"
    ],
    "message": "Le num√©ro de page doit √™tre positif"
  },
  {
    "origin": "number",
    "code": "too_small",
    "minimum": 1,
    "inclusive": true,
    "path": [
      "limit"
    ],
    "message": "La limite doit √™tre au moins 1"
  },
  {
    "code": "invalid_value",
    "values": [
      "SOUMIS",
      "RECU",
      "EN_COURS",
      "ATTENTE_INFO",
      "VALIDE",
      "REJETE",
      "TRAITE",
      "ARCHIVE"
    ],
    "path": [
      "statut"
    ],
    "message": "Veuillez s√©lectionner un statut valide"
  },
  {
    "code": "invalid_value",
    "values": [
      "BASSE",
      "NORMALE",
      "HAUTE",
      "URGENTE"
    ],
    "path": [
      "priorite"
    ],
    "message": "Veuillez s√©lectionner une priorit√© valide"
  },
  {
    "code": "invalid_value",
    "values": [
      "ATTESTATION_SCOLARITE",
      "RELEVE_NOTES",
      "ATTESTATION_REUSSITE",
      "DUPLICATA_CARTE",
      "CONVENTION_STAGE"
    ],
    "path": [
      "typeDemande"
    ],
    "message": "Veuillez s√©lectionner un type de demande valide"
  },
  {
    "expected": "string",
    "code": "invalid_type",
    "path": [
      "sortBy"
    ],
    "message": "Invalid input: expected string, received null"
  },
  {
    "expected": "string",
    "code": "invalid_type",
    "path": [
      "search"
    ],
    "message": "Invalid input: expected string, received null"
  }
]
    at Module.GET [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mapp\api\demandes\route.ts:17:39[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mC:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39m__tests__\integration\api\demandes\route.test.ts:115:19
    at [90mfile:///C:/Users/AdnaneSABER/OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

[90mstderr[2m | __tests__/integration/api/demandes/[id]/route.test.ts[2m > [22m[2m/api/demandes/[id][2m > [22m[2mGET[2m > [22m[2mretourne une erreur 400 pour un ID invalide
[22m[39mAPI Error: CastError: Cast to ObjectId failed for value "invalid-id" (type string) at path "_id" for model "Demande"
    at SchemaObjectId.cast [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\schema\objectId.js:253:11[90m)[39m
    at SchemaObjectId.SchemaType.applySetters [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\schemaType.js:1280:12[90m)[39m
    at SchemaObjectId.SchemaType.castForQuery [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\schemaType.js:1706:17[90m)[39m
    at cast [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\cast.js:386:32[90m)[39m
    at model.Query.Query.cast [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\query.js:5040:12[90m)[39m
    at model.Query.Query._castConditions [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\query.js:2374:10[90m)[39m
    at model.Query._findOne [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\query.js:2704:8[90m)[39m
    at model.Query.exec [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\query.js:4652:80[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at GET [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mapp\api\demandes\[id]\route.ts:16:21[90m)[39m {
  stringValue: [32m'"invalid-id"'[39m,
  messageFormat: [90mundefined[39m,
  kind: [32m'ObjectId'[39m,
  value: [32m'invalid-id'[39m,
  path: [32m'_id'[39m,
  reason: BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer
      at new ObjectId [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mbson[24m\src\objectid.ts:113:15[90m)[39m
      at castObjectId [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\cast\objectid.js:25:12[90m)[39m
      at SchemaObjectId.cast [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\schema\objectId.js:251:12[90m)[39m
      at SchemaObjectId.SchemaType.applySetters [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\schemaType.js:1280:12[90m)[39m
      at SchemaObjectId.SchemaType.castForQuery [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\schemaType.js:1706:17[90m)[39m
      at cast [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\cast.js:386:32[90m)[39m
      at model.Query.Query.cast [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\query.js:5040:12[90m)[39m
      at model.Query.Query._castConditions [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\query.js:2374:10[90m)[39m
      at model.Query._findOne [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\query.js:2704:8[90m)[39m
      at model.Query.exec [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\query.js:4652:80[90m)[39m,
  valueType: [32m'string'[39m
}

 [32m‚úì[39m __tests__/unit/components/admin/status-modifier-dialog.test.tsx [2m([22m[2m18 tests[22m[2m)[22m[33m 2478[2mms[22m[39m
   [33m[2m‚úì[22m[39m StatusModifierDialog[2m > [22msoumet le formulaire avec succ√®s [33m 546[2mms[22m[39m
   [33m[2m‚úì[22m[39m StatusModifierDialog[2m > [22msoumet avec motif de refus pour le statut REJETE [33m 617[2mms[22m[39m
   [33m[2m‚úì[22m[39m StatusModifierDialog[2m > [22mr√©initialise le formulaire apr√®s fermeture [33m 417[2mms[22m[39m
[90mstderr[2m | __tests__/integration/api/demandes/route.test.ts[2m > [22m[2m/api/demandes[2m > [22m[2mGET[2m > [22m[2mfiltre les demandes par statut
[22m[39mAPI Error: ZodError: [
  {
    "origin": "number",
    "code": "too_small",
    "minimum": 0,
    "inclusive": false,
    "path": [
      "page"
    ],
    "message": "Le num√©ro de page doit √™tre positif"
  },
  {
    "origin": "number",
    "code": "too_small",
    "minimum": 1,
    "inclusive": true,
    "path": [
      "limit"
    ],
    "message": "La limite doit √™tre au moins 1"
  },
  {
    "code": "invalid_value",
    "values": [
      "BASSE",
      "NORMALE",
      "HAUTE",
      "URGENTE"
    ],
    "path": [
      "priorite"
    ],
    "message": "Veuillez s√©lectionner une priorit√© valide"
  },
  {
    "code": "invalid_value",
    "values": [
      "ATTESTATION_SCOLARITE",
      "RELEVE_NOTES",
      "ATTESTATION_REUSSITE",
      "DUPLICATA_CARTE",
      "CONVENTION_STAGE"
    ],
    "path": [
      "typeDemande"
    ],
    "message": "Veuillez s√©lectionner un type de demande valide"
  },
  {
    "expected": "string",
    "code": "invalid_type",
    "path": [
      "sortBy"
    ],
    "message": "Invalid input: expected string, received null"
  },
  {
    "expected": "string",
    "code": "invalid_type",
    "path": [
      "search"
    ],
    "message": "Invalid input: expected string, received null"
  }
]
    at Module.GET [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mapp\api\demandes\route.ts:17:39[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mC:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39m__tests__\integration\api\demandes\route.test.ts:189:19
    at [90mfile:///C:/Users/AdnaneSABER/OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

[90mstderr[2m | __tests__/integration/api/demandes/[id]/transition/route.test.ts[2m > [22m[2m/api/demandes/[id]/transition[2m > [22m[2mPOST[2m > [22m[2mretourne une erreur 400 pour un ID invalide
[22m[39mAPI Error: CastError: Cast to ObjectId failed for value "invalid-id" (type string) at path "_id" for model "Demande"
    at SchemaObjectId.cast [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\schema\objectId.js:253:11[90m)[39m
    at SchemaObjectId.SchemaType.applySetters [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\schemaType.js:1280:12[90m)[39m
    at SchemaObjectId.SchemaType.castForQuery [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\schemaType.js:1706:17[90m)[39m
    at cast [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\cast.js:386:32[90m)[39m
    at model.Query.Query.cast [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\query.js:5040:12[90m)[39m
    at model.Query.Query._castConditions [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\query.js:2374:10[90m)[39m
    at model.Query._findOne [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\query.js:2704:8[90m)[39m
    at model.Query.exec [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\query.js:4652:80[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at POST [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mapp\api\demandes\[id]\transition\route.ts:25:21[90m)[39m {
  stringValue: [32m'"invalid-id"'[39m,
  messageFormat: [90mundefined[39m,
  kind: [32m'ObjectId'[39m,
  value: [32m'invalid-id'[39m,
  path: [32m'_id'[39m,
  reason: BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer
      at new ObjectId [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mbson[24m\src\objectid.ts:113:15[90m)[39m
      at castObjectId [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\cast\objectid.js:25:12[90m)[39m
      at SchemaObjectId.cast [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\schema\objectId.js:251:12[90m)[39m
      at SchemaObjectId.SchemaType.applySetters [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\schemaType.js:1280:12[90m)[39m
      at SchemaObjectId.SchemaType.castForQuery [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\schemaType.js:1706:17[90m)[39m
      at cast [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\cast.js:386:32[90m)[39m
      at model.Query.Query.cast [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\query.js:5040:12[90m)[39m
      at model.Query.Query._castConditions [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\query.js:2374:10[90m)[39m
      at model.Query._findOne [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\query.js:2704:8[90m)[39m
      at model.Query.exec [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\query.js:4652:80[90m)[39m,
  valueType: [32m'string'[39m
}

[90mstderr[2m | __tests__/integration/api/demandes/[id]/transition/route.test.ts[2m > [22m[2m/api/demandes/[id]/transition[2m > [22m[2mPOST[2m > [22m[2mretourne une erreur 400 pour un statut invalide
[22m[39mAPI Error: ZodError: [
  {
    "code": "invalid_value",
    "values": [
      "RECU",
      "EN_COURS",
      "ATTENTE_INFO",
      "VALIDE",
      "REJETE",
      "TRAITE",
      "ARCHIVE"
    ],
    "path": [
      "newStatut"
    ],
    "message": "Veuillez s√©lectionner un statut de transition valide"
  }
]
    at POST [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mapp\api\demandes\[id]\transition\route.ts:18:47[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mC:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39m__tests__\integration\api\demandes\[id]\transition\route.test.ts:310:19
    at [90mfile:///C:/Users/AdnaneSABER/OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

[90mstderr[2m | __tests__/integration/api/demandes/[id]/transition/route.test.ts[2m > [22m[2m/api/demandes/[id]/transition[2m > [22m[2mPOST[2m > [22m[2maccepte traiteParId dans la requ√™te
[22m[39mAPI Error: ValidationError: Historique validation failed: utilisateur.id: Cast to ObjectId failed for value "admin-id" (type string) at path "utilisateur.id" because of "BSONError"
    at model.Document.invalidate [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\document.js:3385:32[90m)[39m
    at model.$set [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\document.js:1504:12[90m)[39m
    at model.$set [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\document.js:1253:14[90m)[39m
    at model.$set [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\document.js:1143:14[90m)[39m
    at model.Document [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\document.js:178:12[90m)[39m
    at model.Model [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\model.js:129:12[90m)[39m
    at new model [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\model.js:4668:15[90m)[39m
    at [90mC:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\model.js:2711:20
    at Array.map (<anonymous>)
    at Function.create [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\model.js:2699:34[90m)[39m {
  errors: {
    [32m'utilisateur.id'[39m: CastError: Cast to ObjectId failed for value "admin-id" (type string) at path "utilisateur.id" because of "BSONError"
        at SchemaObjectId.cast [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\schema\objectId.js:253:11[90m)[39m
        at SchemaObjectId.SchemaType.applySetters [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\schemaType.js:1280:12[90m)[39m
        at model.$set [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\document.js:1464:22[90m)[39m
        at model.$set [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\document.js:1253:14[90m)[39m
        at model.$set [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\document.js:1143:14[90m)[39m
        at model.Document [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\document.js:178:12[90m)[39m
        at model.Model [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\model.js:129:12[90m)[39m
        at new model [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\model.js:4668:15[90m)[39m
        at [90mC:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\model.js:2711:20
        at Array.map (<anonymous>) {
      stringValue: [32m'"admin-id"'[39m,
      messageFormat: [90mundefined[39m,
      kind: [32m'ObjectId'[39m,
      value: [32m'admin-id'[39m,
      path: [32m'utilisateur.id'[39m,
      reason: BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer
          at new ObjectId [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mbson[24m\src\objectid.ts:113:15[90m)[39m
          at castObjectId [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\cast\objectid.js:25:12[90m)[39m
          at SchemaObjectId.cast [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\schema\objectId.js:251:12[90m)[39m
          at SchemaObjectId.SchemaType.applySetters [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\schemaType.js:1280:12[90m)[39m
          at model.$set [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\document.js:1464:22[90m)[39m
          at model.$set [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\document.js:1253:14[90m)[39m
          at model.$set [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\document.js:1143:14[90m)[39m
          at model.Document [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\document.js:178:12[90m)[39m
          at model.Model [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\model.js:129:12[90m)[39m
          at new model [90m(C:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39mnode_modules\[4mmongoose[24m\lib\model.js:4668:15[90m)[39m,
      valueType: [32m'string'[39m
    }
  },
  _message: [32m'Historique validation failed'[39m
}

[1m[35m
Restarting due to config changes...[39m[22m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Suites 1 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m __tests__/unit/components/demandes/demande-form.test.tsx[2m [ __tests__/unit/components/demandes/demande-form.test.tsx ][22m
[31m[1mReferenceError[22m: cvi is not defined[39m
[90m [2m‚ùØ[22m __tests__/unit/components/demandes/demande-form.test.tsx:[2m42:1[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/26]‚éØ[22m[39m


[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Tests 25 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/route.test.ts[2m > [22m/api/demandes[2m > [22mGET[2m > [22mretourne une liste vide quand aucune demande n'existe
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[90m [2m‚ùØ[22m __tests__/integration/api/demandes/route.test.ts:[2m36:26[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/26]‚éØ[22m[39m

[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/route.test.ts[2m > [22m/api/demandes[2m > [22mGET[2m > [22mretourne la liste des demandes avec pagination
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 400[39m

[90m [2m‚ùØ[22m __tests__/integration/api/demandes/route.test.ts:[2m117:26[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/26]‚éØ[22m[39m

[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/route.test.ts[2m > [22m/api/demandes[2m > [22mGET[2m > [22mfiltre les demandes par statut
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 400[39m

[90m [2m‚ùØ[22m __tests__/integration/api/demandes/route.test.ts:[2m191:26[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/26]‚éØ[22m[39m

[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/route.test.ts[2m > [22m/api/demandes[2m > [22mGET[2m > [22mfiltre les demandes par priorit√©
[31m[1mMongoServerError[22m: E11000 duplicate key error collection: yassine.demandes index: numeroDemande_1 dup key: { numeroDemande: "DEM-2026-000001" }[39m
[90m [2m‚ùØ[22m InsertOneOperation.handleOk node_modules/mongodb/src/operations/insert.ts:[2m79:13[22m[39m
[90m [2m‚ùØ[22m tryOperation node_modules/mongodb/src/operations/execute_operation.ts:[2m294:26[22m[39m
[90m [2m‚ùØ[22m executeOperation node_modules/mongodb/src/operations/execute_operation.ts:[2m123:12[22m[39m
[90m [2m‚ùØ[22m Collection.insertOne node_modules/mongodb/src/collection.ts:[2m294:12[22m[39m
[90m [2m‚ùØ[22m model.$__save node_modules/mongoose/lib/model.js:[2m398:16[22m[39m
[90m [2m‚ùØ[22m model.save node_modules/mongoose/lib/model.js:[2m609:5[22m[39m
[90m [2m‚ùØ[22m node_modules/mongoose/lib/model.js:[2m2714:9[22m[39m
[90m [2m‚ùØ[22m Function.create node_modules/mongoose/lib/model.js:[2m2699:11[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/26]‚éØ[22m[39m

[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/route.test.ts[2m > [22m/api/demandes[2m > [22mGET[2m > [22mfiltre les demandes par type
[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/route.test.ts[2m > [22m/api/demandes[2m > [22mGET[2m > [22mrecherche les demandes par texte
[41m[1m FAIL [22m[49m __tests__/integration/api/admin/students/route.test.ts[2m > [22m/api/admin/students[2m > [22mGET[2m > [22mne retourne pas le hashPassword
[41m[1m FAIL [22m[49m __tests__/integration/api/admin/students/route.test.ts[2m > [22m/api/admin/students[2m > [22mGET[2m > [22mg√®re la pagination
[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/[id]/route.test.ts[2m > [22m/api/demandes/[id][2m > [22mPATCH[2m > [22mmet √† jour une demande avec succ√®s
[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/[id]/route.test.ts[2m > [22m/api/demandes/[id][2m > [22mPATCH[2m > [22mretourne une erreur 400 pour des donn√©es invalides
[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/[id]/transition/route.test.ts[2m > [22m/api/demandes/[id]/transition[2m > [22mPOST[2m > [22mretourne une erreur 400 pour une transition invalide
[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/[id]/transition/route.test.ts[2m > [22m/api/demandes/[id]/transition[2m > [22mPOST[2m > [22mretourne une erreur 400 si motifRefus manquant pour REJETE
[31m[1mMongoServerError[22m: E11000 duplicate key error collection: yassine.etudiants index: matricule_1 dup key: { matricule: "TEST001" }[39m
[90m [2m‚ùØ[22m InsertOneOperation.handleOk node_modules/mongodb/src/operations/insert.ts:[2m79:13[22m[39m
[90m [2m‚ùØ[22m tryOperation node_modules/mongodb/src/operations/execute_operation.ts:[2m294:26[22m[39m
[90m [2m‚ùØ[22m executeOperation node_modules/mongodb/src/operations/execute_operation.ts:[2m123:12[22m[39m
[90m [2m‚ùØ[22m Collection.insertOne node_modules/mongodb/src/collection.ts:[2m294:12[22m[39m
[90m [2m‚ùØ[22m model.$__save node_modules/mongoose/lib/model.js:[2m398:16[22m[39m
[90m [2m‚ùØ[22m model.save node_modules/mongoose/lib/model.js:[2m609:5[22m[39m
[90m [2m‚ùØ[22m node_modules/mongoose/lib/model.js:[2m2714:9[22m[39m
[90m [2m‚ùØ[22m Function.create node_modules/mongoose/lib/model.js:[2m2699:11[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/26]‚éØ[22m[39m

[41m[1m FAIL [22m[49m __tests__/integration/api/admin/students/route.test.ts[2m > [22m/api/admin/students[2m > [22mGET[2m > [22mretourne une liste vide quand aucun √©tudiant n'existe
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[90m [2m‚ùØ[22m __tests__/integration/api/admin/students/route.test.ts:[2m61:26[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/26]‚éØ[22m[39m

[41m[1m FAIL [22m[49m __tests__/integration/api/admin/students/route.test.ts[2m > [22m/api/admin/students[2m > [22mGET[2m > [22mretourne la liste des √©tudiants
[31m[1mAssertionError[22m: expected [ { ‚Ä¶(10) } ] to have a length of 2 but got 1[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 2[39m
[31m+ 1[39m

[90m [2m‚ùØ[22m __tests__/integration/api/admin/students/route.test.ts:[2m87:34[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[8/26]‚éØ[22m[39m

[41m[1m FAIL [22m[49m __tests__/integration/api/admin/students/route.test.ts[2m > [22m/api/admin/students[2m > [22mGET[2m > [22mretourne uniquement les √©tudiants actifs
[31m[1mAssertionError[22m: expected [] to have a length of 1 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[90m [2m‚ùØ[22m __tests__/integration/api/admin/students/route.test.ts:[2m151:34[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[9/26]‚éØ[22m[39m

[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/[id]/route.test.ts[2m > [22m/api/demandes/[id][2m > [22mGET[2m > [22mretourne les d√©tails d'une demande existante
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[90m [2m‚ùØ[22m __tests__/integration/api/demandes/[id]/route.test.ts:[2m76:26[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[10/26]‚éØ[22m[39m

[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/[id]/route.test.ts[2m > [22m/api/demandes/[id][2m > [22mGET[2m > [22mretourne une erreur 400 pour un ID invalide
[31m[1mAssertionError[22m: expected 500 to be 400 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 500[39m

[90m [2m‚ùØ[22m __tests__/integration/api/demandes/[id]/route.test.ts:[2m101:26[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[11/26]‚éØ[22m[39m

[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/[id]/transition/route.test.ts[2m > [22m/api/demandes/[id]/transition[2m > [22mPOST[2m > [22mtransitionne une demande de SOUMIS √† RECU
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[90m [2m‚ùØ[22m __tests__/integration/api/demandes/[id]/transition/route.test.ts:[2m90:26[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[12/26]‚éØ[22m[39m

[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/[id]/transition/route.test.ts[2m > [22m/api/demandes/[id]/transition[2m > [22mPOST[2m > [22mtransitionne une demande de RECU √† EN_COURS
[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/[id]/transition/route.test.ts[2m > [22m/api/demandes/[id]/transition[2m > [22mPOST[2m > [22mtransitionne une demande de EN_COURS √† VALIDE
[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/[id]/transition/route.test.ts[2m > [22m/api/demandes/[id]/transition[2m > [22mPOST[2m > [22mtransitionne une demande de EN_COURS √† REJETE avec motif
[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/[id]/transition/route.test.ts[2m > [22m/api/demandes/[id]/transition[2m > [22mPOST[2m > [22mtransitionne une demande de EN_COURS √† ATTENTE_INFO
[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/[id]/transition/route.test.ts[2m > [22m/api/demandes/[id]/transition[2m > [22mPOST[2m > [22mtransitionne une demande de VALIDE √† TRAITE
[31m[1mMongoServerError[22m: E11000 duplicate key error collection: test.etudiants index: matricule_1 dup key: { matricule: "TEST001" }[39m
[90m [2m‚ùØ[22m InsertOneOperation.handleOk node_modules/mongodb/src/operations/insert.ts:[2m79:13[22m[39m
[90m [2m‚ùØ[22m tryOperation node_modules/mongodb/src/operations/execute_operation.ts:[2m294:26[22m[39m
[90m [2m‚ùØ[22m executeOperation node_modules/mongodb/src/operations/execute_operation.ts:[2m123:12[22m[39m
[90m [2m‚ùØ[22m Collection.insertOne node_modules/mongodb/src/collection.ts:[2m294:12[22m[39m
[90m [2m‚ùØ[22m model.$__save node_modules/mongoose/lib/model.js:[2m398:16[22m[39m
[90m [2m‚ùØ[22m model.save node_modules/mongoose/lib/model.js:[2m609:5[22m[39m
[90m [2m‚ùØ[22m node_modules/mongoose/lib/model.js:[2m2714:9[22m[39m
[90m [2m‚ùØ[22m Function.create node_modules/mongoose/lib/model.js:[2m2699:11[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[13/26]‚éØ[22m[39m

[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/[id]/transition/route.test.ts[2m > [22m/api/demandes/[id]/transition[2m > [22mPOST[2m > [22mretourne une erreur 400 pour un ID invalide
[31m[1mAssertionError[22m: expected 500 to be 400 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 500[39m

[90m [2m‚ùØ[22m __tests__/integration/api/demandes/[id]/transition/route.test.ts:[2m291:26[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[14/26]‚éØ[22m[39m

[41m[1m FAIL [22m[49m __tests__/integration/api/demandes/[id]/transition/route.test.ts[2m > [22m/api/demandes/[id]/transition[2m > [22mPOST[2m > [22maccepte traiteParId dans la requ√™te
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[90m [2m‚ùØ[22m __tests__/integration/api/demandes/[id]/transition/route.test.ts:[2m336:26[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[15/26]‚éØ[22m[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Unhandled Errors [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m
[31m[1m
Vitest caught 5 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.[22m[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Unhandled Error [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m
[31m[1mError[22m: Terminating worker thread[39m
[90m [2m‚ùØ[22m Object.ThreadTermination ../../../../OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/node_modules/tinypool/dist/index.js:[2m393:27[22m[39m
[90m [2m‚ùØ[22m ../../../../OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/node_modules/tinypool/dist/index.js:[2m432:73[22m[39m
[90m [2m‚ùØ[22m process.processTicksAndRejections node:internal/process/task_queues:[2m105:5[22m[39m


[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Unhandled Error [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m
[31m[1mError[22m: Terminating worker thread[39m
[90m [2m‚ùØ[22m Object.ThreadTermination ../../../../OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/node_modules/tinypool/dist/index.js:[2m393:27[22m[39m
[90m [2m‚ùØ[22m ../../../../OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/node_modules/tinypool/dist/index.js:[2m432:73[22m[39m
[90m [2m‚ùØ[22m process.processTicksAndRejections node:internal/process/task_queues:[2m105:5[22m[39m


[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Unhandled Error [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m
[31m[1mError[22m: Terminating worker thread[39m
[90m [2m‚ùØ[22m Object.ThreadTermination ../../../../OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/node_modules/tinypool/dist/index.js:[2m393:27[22m[39m
[90m [2m‚ùØ[22m ../../../../OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/node_modules/tinypool/dist/index.js:[2m432:73[22m[39m
[90m [2m‚ùØ[22m process.processTicksAndRejections node:internal/process/task_queues:[2m105:5[22m[39m


[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Unhandled Error [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m
[31m[1mError[22m: Terminating worker thread[39m
[90m [2m‚ùØ[22m Object.ThreadTermination ../../../../OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/node_modules/tinypool/dist/index.js:[2m393:27[22m[39m
[90m [2m‚ùØ[22m ../../../../OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/node_modules/tinypool/dist/index.js:[2m432:73[22m[39m
[90m [2m‚ùØ[22m process.processTicksAndRejections node:internal/process/task_queues:[2m105:5[22m[39m


[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Unhandled Error [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m
[31m[1mError[22m: Terminating worker thread[39m
[90m [2m‚ùØ[22m Object.ThreadTermination ../../../../OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/node_modules/tinypool/dist/index.js:[2m393:27[22m[39m
[90m [2m‚ùØ[22m ../../../../OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/node_modules/tinypool/dist/index.js:[2m432:73[22m[39m
[90m [2m‚ùØ[22m process.processTicksAndRejections node:internal/process/task_queues:[2m105:5[22m[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m9 passed[39m[22m[90m (15)[39m
[2m      Tests [22m [1m[31m25 failed[39m[22m[2m | [22m[1m[32m271 passed[39m[22m[90m (344)[39m
[2m     Errors [22m [1m[31m5 errors[39m[22m
[2m   Start at [22m 13:01:32
[2m   Duration [22m 6.08s[2m (transform 1.96s, setup 6.58s, collect 6.52s, tests 4.02s, environment 14.10s, prepare 3.31s)[22m

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
‚úÖ .env.local loaded

[1m[44m DEV [49m[22m [34mv3.2.4 [39m[90mC:/Users/AdnaneSABER/OneDrive - CHAPSVISION/Documents/GitHub/yassine-1[39m

 [32m‚úì[39m __tests__/unit/lib/workflow/constants.test.ts [2m([22m[2m28 tests[22m[2m)[22m[32m 7[2mms[22m[39m
 [32m‚úì[39m __tests__/unit/lib/utils.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 8[2mms[22m[39m
[90mstderr[2m | __tests__/unit/lib/workflow/state-machine.test.ts[2m > [22m[2mDemandeWorkflow[2m > [22m[2mnotifications[2m > [22m[2mne lance pas d'erreur si l'envoi d'email √©choue
[22m[39mFailed to send email notification: Erreur email

[90mstderr[2m | __tests__/unit/lib/workflow/state-machine.test.ts[2m > [22m[2mDemandeWorkflow[2m > [22m[2mnotifications[2m > [22m[2mne lance pas d'erreur si le service email lance une exception
[22m[39mError sending notification: Error: Erreur r√©seau
    at [90mC:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39m__tests__\unit\lib\workflow\state-machine.test.ts:278:82
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///C:/Users/AdnaneSABER/OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

 [32m‚úì[39m __tests__/unit/lib/workflow/state-machine.test.ts [2m([22m[2m31 tests[22m[2m)[22m[32m 28[2mms[22m[39m
 [32m‚úì[39m __tests__/unit/lib/validators/demande.test.ts [2m([22m[2m85 tests[22m[2m)[22m[32m 22[2mms[22m[39m
 [32m‚úì[39m __tests__/unit/components/demandes/demande-card.test.tsx [2m([22m[2m13 tests[22m[2m)[22m[32m 107[2mms[22m[39m
 [32m‚úì[39m __tests__/unit/components/demandes/demande-detail.test.tsx [2m([22m[2m21 tests[22m[2m)[22m[32m 159[2mms[22m[39m
[90mstderr[2m | __tests__/unit/components/admin/demandes-table.test.tsx[2m > [22m[2mDemandesTable[2m > [22m[2mg√®re les demandes sans _id
[22m[39mEach child in a list should have a unique "key" prop.

Check the render method of `TableBody`. It was passed a child from DemandesTable. See https://react.dev/link/warning-keys for more information.

 [32m‚úì[39m __tests__/unit/components/admin/demandes-table.test.tsx [2m([22m[2m17 tests[22m[2m)[22m[32m 231[2mms[22m[39m
[90mstderr[2m | __tests__/unit/components/admin/status-modifier-dialog.test.tsx[2m > [22m[2mStatusModifierDialog[2m > [22m[2msoumet le formulaire avec succ√®s
[22m[39mThe current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)

[90mstderr[2m | __tests__/unit/components/admin/status-modifier-dialog.test.tsx[2m > [22m[2mStatusModifierDialog[2m > [22m[2msoumet avec motif de refus pour le statut REJETE
[22m[39mThe current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)

[90mstderr[2m | __tests__/unit/components/admin/status-modifier-dialog.test.tsx[2m > [22m[2mStatusModifierDialog[2m > [22m[2mg√®re les erreurs de l'action
[22m[39mThe current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)

[90mstderr[2m | __tests__/unit/components/admin/status-modifier-dialog.test.tsx[2m > [22m[2mStatusModifierDialog[2m > [22m[2mg√®re les erreurs inattendues
[22m[39mThe current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)

 [32m‚úì[39m __tests__/unit/components/admin/status-modifier-dialog.test.tsx [2m([22m[2m18 tests[22m[2m)[22m[33m 2472[2mms[22m[39m
   [33m[2m‚úì[22m[39m StatusModifierDialog[2m > [22msoumet le formulaire avec succ√®s [33m 590[2mms[22m[39m
   [33m[2m‚úì[22m[39m StatusModifierDialog[2m > [22msoumet avec motif de refus pour le statut REJETE [33m 638[2mms[22m[39m
   [33m[2m‚úì[22m[39m StatusModifierDialog[2m > [22mr√©initialise le formulaire apr√®s fermeture [33m 402[2mms[22m[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Suites 1 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m __tests__/unit/components/demandes/demande-form.test.tsx[2m [ __tests__/unit/components/demandes/demande-form.test.tsx ][22m
[31m[1mReferenceError[22m: cvi is not defined[39m
[36m [2m‚ùØ[22m __tests__/unit/components/demandes/demande-form.test.tsx:[2m42:1[22m[39m
    [90m 40| [39m
    [90m 41| [39m[90m// Mock des composants UI de shadcn[39m
    [90m 42| [39mcvi[33m.[39m[34mmock[39m([32m'@/components/ui/form'[39m[33m,[39m () [33m=>[39m ({
    [90m   | [39m[31m^[39m
    [90m 43| [39m  Form: ({ children }: { children: React.ReactNode }) => <form data-te‚Ä¶
    [90m 44| [39m  FormControl: ({ children }: { children: React.ReactNode }) => <>{chi‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/1]‚éØ[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m8 passed[39m[22m[90m (9)[39m
[2m      Tests [22m [1m[32m227 passed[39m[22m[90m (227)[39m
[2m   Start at [22m 13:01:38
[2m   Duration [22m 4.03s[2m (transform 345ms, setup 3.02s, collect 790ms, tests 3.03s, environment 6.31s, prepare 1.40s)[22m

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mpackage.json [22m[39m

 [32m‚úì[39m __tests__/unit/lib/workflow/constants.test.ts [2m([22m[2m28 tests[22m[2m)[22m[32m 7[2mms[22m[39m
[90mstderr[2m | __tests__/unit/lib/workflow/state-machine.test.ts[2m > [22m[2mDemandeWorkflow[2m > [22m[2mnotifications[2m > [22m[2mne lance pas d'erreur si l'envoi d'email √©choue
[22m[39mFailed to send email notification: Erreur email

[90mstderr[2m | __tests__/unit/lib/workflow/state-machine.test.ts[2m > [22m[2mDemandeWorkflow[2m > [22m[2mnotifications[2m > [22m[2mne lance pas d'erreur si le service email lance une exception
[22m[39mError sending notification: Error: Erreur r√©seau
    at [90mC:\Users\AdnaneSABER\OneDrive - CHAPSVISION\Documents\GitHub\yassine-1\[39m__tests__\unit\lib\workflow\state-machine.test.ts:278:82
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///C:/Users/AdnaneSABER/OneDrive%20-%20CHAPSVISION/Documents/GitHub/yassine-1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

 [32m‚úì[39m __tests__/unit/lib/workflow/state-machine.test.ts [2m([22m[2m31 tests[22m[2m)[22m[32m 23[2mms[22m[39m
 [32m‚úì[39m __tests__/unit/lib/utils.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32m‚úì[39m __tests__/unit/lib/validators/demande.test.ts [2m([22m[2m85 tests[22m[2m)[22m[32m 20[2mms[22m[39m
 [32m‚úì[39m __tests__/unit/components/demandes/demande-card.test.tsx [2m([22m[2m13 tests[22m[2m)[22m[32m 104[2mms[22m[39m
 [32m‚úì[39m __tests__/unit/components/demandes/demande-detail.test.tsx [2m([22m[2m21 tests[22m[2m)[22m[32m 152[2mms[22m[39m
[90mstderr[2m | __tests__/unit/components/admin/demandes-table.test.tsx[2m > [22m[2mDemandesTable[2m > [22m[2mg√®re les demandes sans _id
[22m[39mEach child in a list should have a unique "key" prop.

Check the render method of `TableBody`. It was passed a child from DemandesTable. See https://react.dev/link/warning-keys for more information.

 [32m‚úì[39m __tests__/unit/components/admin/demandes-table.test.tsx [2m([22m[2m17 tests[22m[2m)[22m[32m 238[2mms[22m[39m
[90mstderr[2m | __tests__/unit/components/admin/status-modifier-dialog.test.tsx[2m > [22m[2mStatusModifierDialog[2m > [22m[2msoumet le formulaire avec succ√®s
[22m[39mThe current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)

[90mstderr[2m | __tests__/unit/components/admin/status-modifier-dialog.test.tsx[2m > [22m[2mStatusModifierDialog[2m > [22m[2msoumet avec motif de refus pour le statut REJETE
[22m[39mThe current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)

[90mstderr[2m | __tests__/unit/components/admin/status-modifier-dialog.test.tsx[2m > [22m[2mStatusModifierDialog[2m > [22m[2mg√®re les erreurs de l'action
[22m[39mThe current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)

[90mstderr[2m | __tests__/unit/components/admin/status-modifier-dialog.test.tsx[2m > [22m[2mStatusModifierDialog[2m > [22m[2mg√®re les erreurs inattendues
[22m[39mThe current testing environment is not configured to support act(...)
The current testing environment is not configured to support act(...)

 [32m‚úì[39m __tests__/unit/components/admin/status-modifier-dialog.test.tsx [2m([22m[2m18 tests[22m[2m)[22m[33m 2544[2mms[22m[39m
   [33m[2m‚úì[22m[39m StatusModifierDialog[2m > [22msoumet le formulaire avec succ√®s [33m 578[2mms[22m[39m
   [33m[2m‚úì[22m[39m StatusModifierDialog[2m > [22msoumet avec motif de refus pour le statut REJETE [33m 634[2mms[22m[39m
   [33m[2m‚úì[22m[39m StatusModifierDialog[2m > [22mr√©initialise le formulaire apr√®s fermeture [33m 442[2mms[22m[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Suites 1 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m __tests__/unit/components/demandes/demande-form.test.tsx[2m [ __tests__/unit/components/demandes/demande-form.test.tsx ][22m
[31m[1mReferenceError[22m: cvi is not defined[39m
[36m [2m‚ùØ[22m __tests__/unit/components/demandes/demande-form.test.tsx:[2m42:1[22m[39m
    [90m 40| [39m
    [90m 41| [39m[90m// Mock des composants UI de shadcn[39m
    [90m 42| [39mcvi[33m.[39m[34mmock[39m([32m'@/components/ui/form'[39m[33m,[39m () [33m=>[39m ({
    [90m   | [39m[31m^[39m
    [90m 43| [39m  Form: ({ children }: { children: React.ReactNode }) => <form data-te‚Ä¶
    [90m 44| [39m  FormControl: ({ children }: { children: React.ReactNode }) => <>{chi‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/1]‚éØ[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m8 passed[39m[22m[90m (9)[39m
[2m      Tests [22m [1m[32m227 passed[39m[22m[90m (227)[39m
[2m   Start at [22m 13:03:03
[2m   Duration [22m 6.39s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
[31mCancelling test run. Press CTRL+c again to exit forcefully.
[39m
